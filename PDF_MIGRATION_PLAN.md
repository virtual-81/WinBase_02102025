# План миграции PDF (Delphi 12)

Цель: заменить устаревший самописный модуль `llpdf/PDF.pas` на современный и поддерживаемый движок PDF для Delphi 12, сохранив текущую логику печати/экспорта и кириллицу.

## Критерии
- Поддержка Delphi 12 (Win32/Win64).
- Корректная Unicode/кириллица без танцев с шрифтами.
- Рендеринг через Canvas-подобный API (минимум переписывания).
- Пагинация, шрифты, сжатие, закладки (по возможности).
- Без платных лицензий.

## Рекомендация: SynPDF (TPdfDocumentGDI)
- Плюсы: рендеринг через GDI/VCL Canvas (минимальные правки), Unicode, зрелость, открытая лицензия.
- Минусы: исходники нужно добавить в проект (vendor/mORMot/SynPDF). 

Альтернативы:
- Skia4Delphi PDF backend — требует миграции на Skia Canvas (больше рефакторинга).
- FastReport PDF экспорт — проще для отчетов, но платный и меняет подход.
- PDFium — больше про просмотр/рендер, создание PDF сложнее.

## Интеграционная стратегия
1) Этап совместимости (уже в коде): `MyPrint.TPDFDocument` — единая точка абстракции PDF. Сейчас заглушка совместимости.
2) Добавить адаптер SynPDF за флагом `USE_SYNPDF` в `MyPrint.pas` (или отдельный `PDF_Adapter_SynPDF.pas`).
   - Подменить внутреннюю реализацию `TPDFDocument`: использовать `TPdfDocumentGDI`.
   - Сопоставить свойства: `DocumentInfo.Title/Author/...`, `PageLayout`, `PageMode`, `Resolution`, `FileName`.
   - Методы: `BeginDoc`, `NewPage`, `EndDoc`, `Abort`.
   - Canvas: использовать `TPdfDocumentGDI.VCLCanvas.Canvas`.
3) Подключить исходники SynPDF в путь поиска Delphi 12 и определить `USE_SYNPDF`.
4) Тесты печати/экспорта в ключевых местах (`Save*PDF*` методы в `data*.pas`).
5) Тюнинг: шрифты с кириллицей (встраивание/подмена), сжатие `ctFlate`, закладки (если нужны).

## Точки интеграции в проекте
- `MyPrint.pas` — класс `TMyPrinter` и `TPDFDocument` (единая точка переключения реальной реализации).
- `data*.pas` — вызывают методы `Save*PDF*`, опираясь на интерфейс `TPDFDocument`.

## План работ
- [ ] Подключить исходники SynPDF (локально, без внешних менеджеров пакетов).
- [ ] В `MyPrint.pas` реализовать ветку `{$IFDEF USE_SYNPDF}`: обертка над `TPdfDocumentGDI`.
- [ ] Снять `{$DEFINE DISABLE_PDF}` после успешного прогона smoke-тестов.
- [ ] Тесты: 
  - Экспорт старт-листов/результатов с кириллицей.
  - Многостраничные документы.
  - Баркоды/картинки (если печатаются).
- [ ] Документация по шрифтам (встраивание, если нужно).

## Примечания по шрифтам
- Для устойчивой кириллицы удобно использовать шрифты с полным набором glyph'ов (например, `DejaVu Sans`, `Arial Unicode MS`) и включить встраивание шрифтов (если поддерживается в выбранной библиотеке).

---
Готов к реализации адаптера под `SynPDF` сразу после добавления исходников в проект.
